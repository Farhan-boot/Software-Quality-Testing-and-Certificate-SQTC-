@model PTSL.GENERIC.Web.Core.Model.EntityViewModels.ProjectPackageConfiguration.PaymentCalculationHeaderVM
@{
    ViewBag.Title = "Create";
    var Message = ViewBag.Message;
    ViewBag.activeMenu = "Payment Calculation";
}

@*<style>
    input, select {
        height: 30px !important;
        line-height: 10px !important;
        font-weight: 400 !important;
        color: black !important;
    }

    legend {
        font-weight: 500 !important;
        font-size: 20px !important;
    }
</style>*@


<div class="card">

    <div class="card-header">
        <h4>
            <a href="/PaymentCalculationHeader/Index" class="mr-1 back">
                <svg width="20" height="20" viewBox="0 0 32 32">
                    <path fill="currentColor" d="m14 26l1.41-1.41L7.83 17H28v-2H7.83l7.58-7.59L14 6L4 16l10 10z" />
                </svg>
            </a>
            Create New Payment Calculation
        </h4>
       @*  <button class="ml-auto reset btn btn-sm" onclick="resetFromData('#PaymentCalculationHeaderForm')">
            <svg class="rotate180z" width="16" height="16" viewBox="0 0 32 32">
                <path d="M25.95 7.65l.005-.004c-.092-.11-.197-.206-.293-.312c-.184-.205-.367-.41-.563-.603c-.139-.136-.286-.262-.43-.391c-.183-.165-.366-.329-.558-.482c-.16-.128-.325-.247-.49-.367c-.192-.14-.385-.277-.585-.406a13.513 13.513 0 0 0-.533-.324q-.308-.179-.625-.341c-.184-.094-.37-.185-.56-.27c-.222-.1-.449-.191-.678-.28c-.19-.072-.378-.145-.571-.208c-.246-.082-.498-.15-.75-.217c-.186-.049-.368-.102-.556-.143c-.29-.063-.587-.107-.883-.15c-.16-.023-.315-.056-.476-.073A12.933 12.933 0 0 0 6 7.703V4H4v8h8v-2H6.811A10.961 10.961 0 0 1 16 5a11.111 11.111 0 0 1 1.189.067c.136.015.268.042.403.061c.25.037.501.075.746.128c.16.035.315.08.472.121c.213.057.425.114.633.183c.164.054.325.116.486.178c.193.074.384.15.57.235c.162.072.32.15.477.23q.268.136.526.286c.153.09.305.18.453.276c.168.11.33.224.492.342c.14.102.282.203.417.312c.162.13.316.268.47.406c.123.11.248.217.365.332c.167.164.323.338.479.512A10.993 10.993 0 1 1 5 16H3a13 13 0 1 0 22.95-8.35z" fill="currentColor" />
            </svg>
            Reset
        </button> *@
    </div>



    <div class="card-body">
        @*
        @using (Html.BeginForm("Create", "PaymentCalculationHeader", FormMethod.Post, new { id = "PaymentCalculationHeaderForm" }))
        {
        *@

        <div class="form-horizontal">

            <div class="row custom">
                <div class="col-md-3">
                    <div class="form-group">
                        <label for="inputMeetingType">Project*</label>
                        @Html.DropDownList("ProjectRequestId", null, "Choose Project", htmlAttributes: new { @class = "", @required = "required" })
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="form-group">
                        <label for="inputMeetingType">Task*</label>
                        @Html.DropDownList("TaskOfProjectId", null, "Choose Task", htmlAttributes: new { @class = "", @required = "required" })
                    </div>
                </div>
            </div>

            <div class="row custom">
                <div class="col-md-3">
                    <div class="form-group">
                        <label for="inputMeetingType">Service*</label>
                        @Html.DropDownList("ProjectModuleNameId", null, "Choose Service", htmlAttributes: new { @class = "", @required = "required" })
                    </div>
                </div>
                <div class="col-md-3">
                    <label for="inputMeetingType">Package*</label>
                    <select name="ProjectPackageId" id="ProjectPackageId" required>
                        <option value="0">Choose..</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <div class="form-group">
                        <label for="inputMeetingType">Unit Price*</label>
                        <input type="number" class="form-control" id="UnitPrice" name="UnitPrice" value="" placeholder="Enter Unit Price" required>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="form-group">
                        <label for="inputMeetingType">Number Of Packages*</label>
                        <input type="number" class="form-control" id="NumberOfPackages" name="NumberOfPackages" value="" placeholder="Enter Number Of Packages" required>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="form-group">
                        <label for="inputMeetingType">Total Price*</label>
                        <input type="number" class="form-control" id="TotalPrice" name="TotalPrice" value="" placeholder="Enter Total Price" required>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="form-group">
                        <label for="inputMeetingType">Vat(5%)</label>
                        <input hidden type="number" class="form-control" id="Vat" name="Vat" value="5" placeholder="Enter Vat" required>
                        <input type="number" class="form-control" id="VatAmount" name="VatAmount" value="" placeholder="Enter Vat Amount" readonly>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="form-group">
                        <label for="inputMeetingType">Tax(10%)</label>
                        <input hidden type="number" class="form-control" id="Tax" name="Tax" value="10" placeholder="Enter Tax" required>
                        <input type="number" class="form-control" id="TaxAmount" name="TaxAmount" value="" placeholder="Enter Tax Amount" readonly>
                    </div>
                </div>
            </div>
         @*    <div class="row custom">
                <div class="col-md-3">
                    <div class="form-group">
                        <label for="inputMeetingType">Grand Total</label>
                        <input type="number" class="form-control" id="GrandTotal" name="GrandTotal" value="@Model.GrandTotal" placeholder="Enter Grand Total" required>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="form-group">
                        <label for="inputMeetingType">Grand Total In Word</label>
                        <input type="text" class="form-control" id="GrandTotalInWord" name="GrandTotalInWord" value="@Model.GrandTotalInWord" placeholder="Enter Grand Total In Word" required>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="form-group">
                        <label for="inputMeetingType">Discount Amount</label>
                        <input type="number" class="form-control" id="DiscountAmount" name="DiscountAmount" value="@Model.DiscountAmount" placeholder="Enter Discount Amount" required>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="form-group">
                        <label for="inputMeetingType">Total Amount</label>
                        <input type="number" class="form-control" id="NetTotal" name="NetTotal" value="@Model.NetTotal" placeholder="Enter Discount Amount" required>
                    </div>
                </div>
            </div> *@

            <div class="form-group col-md-12">
                <button onclick="AddToList()" type="button" class="btn btn-primary submit-btn pull-right btn-sm">Add</button>
            </div>
        </div>
        @* } *@
        <br />
        <div class="containar">
            <div class="row">
                <div class="col-md-12">
                    <table class="reportTable" id="grid" role="grid" aria-describedby="tableExport_filter_info" style="width: 1018px;">
                        <thead>
                            <tr role="row">
                                <th class="sorting_asc" tabindex="0" aria-controls="tableExport_filter" rowspan="1" colspan="1" aria-sort="ascending" aria-label="SL: activate to sort column descending" style="min-width: 50px;">SL NO</th>
                                <th class="sorting" tabindex="0" aria-controls="tableExport_filter" aria-label="Forest Department: activate to sort column ascending" style="min-width: 80px;">Project Module Name</th>
                                <th class="sorting" tabindex="0" aria-controls="tableExport_filter" aria-label="Forest Range: activate to sort column ascending" style="min-width: 100px;">Project Package</th>
                                <th class="sorting" tabindex="0" aria-controls="tableExport_filter" aria-label="Forest Beat: activate to sort column ascending" style="min-width: 95px;">Unit Price</th>
                                <th class="sorting" tabindex="0" aria-controls="tableExport_filter" aria-label="Name Of FCV: activate to sort column ascending" style="min-width: 100px;">Number Of Packages</th>
                                <th class="sorting" tabindex="0" aria-controls="tableExport_filter" aria-label="Financial Year: activate to sort column ascending" style="min-width: 50%;">Total Price</th>
                                <th class="sorting" tabindex="0" aria-controls="tableExport_filter" aria-label="Total Scheme: activate to sort column ascending" style="min-width: 60px">Vat</th>
                                <th class="sorting" tabindex="0" aria-controls="tableExport_filter" aria-label="Name Of Approveld Project / Sub Project: activate to sort column ascending" style="min-width: 50px;">Tax</th>
                                <th class="sorting" tabindex="0" aria-controls="tableExport_filter" aria-label="Name Of Approveld Project / Sub Project: activate to sort column ascending" style="min-width: 50px;">Action</th>
                            </tr>
                        </thead>
                        <tbody id="tbodyPaymentCalculation">
                        </tbody>
                    </table>
                    <br />
                    <button onclick="Submit()" type="button" class="btn btn-success pull-right btn-sm">Submit</button>
                    <button onclick="Submit(1)" type="button" class="btn btn-success pull-right btn-sm">Generate And View Report</button>
                </div>
            </div>
        </div>

    </div>
    <hr />
    <div class="card-header pull-left">
        <!-- <a href="/MeetingType/Index" class="btn btn-warning">Return to Index</a> -->
    </div>
</div>

<script>
    $(".submit-btn").on("click", function () {
        if ($("#MeetingTypeForm").valid()) {
            //Do something here
            $(".loader").fadeIn("slow");
        }
    });

    $("#MeetingTypeForm").validate({
        // Specify validation rules
        rules: {
            MeetingTypeName: "required"
        },

    });
</script>

<script>
    $("#ProjectModuleNameId").on("change", function () {
        var ProjectModuleNameIdCheck = $("#ProjectModuleNameId").val();
        if (ProjectModuleNameIdCheck == "") {
            $('#ProjectRequestId').attr("disabled", false);
            $('#TaskOfProjectId').attr("disabled", false);
        }
        else {
            $('#ProjectRequestId').attr("disabled", true);
            $('#TaskOfProjectId').attr("disabled", true);
        }

        const value = $(this).val();
        $.ajax({
            cache: false,
            type: "GET",
            url: "/PaymentCalculationHeader/GetProjectPackageByProjectModuleNameId?id=" + value,
            success: function (data) {
                var ProjectPackageId = $("#ProjectPackageId");
                ProjectPackageId.html('<option value="">Choose..</option>');
                $.each(data.Data, function (id, option) {
                    ProjectPackageId.append($('<option></option>').val(option.Id).html(option.PackageName));
                });
            },
            error: function (xhr, ajaxOptions, thrownError) {
                //
            }
        });
    });
</script>

<script>
    $('#Vat').prop('readonly', true);
    $('#Tax').prop('readonly', true);
    $('#TotalPrice').prop('readonly', true);
    //$('#NumberOfPackages').prop('readonly', true);
    

    $('#GrandTotal').prop('readonly', true);
    $('#GrandTotalInWord').prop('readonly', true);

    var SlNumber = 0;

    function AddToList() {
        var ProjectRequestIdCheck = $('#ProjectRequestId').val();
        var NumberOfPackagesCheck = $('#NumberOfPackages').val();
        if (NumberOfPackagesCheck === "") {
            alert("Plese Select Number Of Packages");
            return;
        }

        if (ProjectRequestIdCheck === "") {
            alert("Plese Select Project");
            return;
        }
        var TaskOfProjectIdCheck = $('#TaskOfProjectId').val();
        if (TaskOfProjectIdCheck === "") {
            alert("Plese Select Task");
            return;
        }
        var ProjectModuleNameIdCheck = $('#ProjectModuleNameId').val();
        if (ProjectModuleNameIdCheck === "") {
            alert("Plese Select Project Module Name");
            return;
        }
        var ProjectPackageIdCheck = $('#ProjectPackageId').val();
        if (ProjectPackageIdCheck === "") {
            alert("Plese Select Project Package");
            return;
        }

        //alert("test");
        SlNumber = SlNumber + 1;
        var ProjectModuleName = $('#ProjectModuleNameId').find('option:selected').text();
        var ProjectModuleNameId = $('#ProjectModuleNameId').find('option:selected').val();

        var ProjectPackage = $('#ProjectPackageId').find('option:selected').text();
        var ProjectPackageId = $('#ProjectPackageId').find('option:selected').val();

        var UnitPrice = $('#UnitPrice').val();
        var NumberOfPackages = $('#NumberOfPackages').val();
        var TotalPrice = Number(UnitPrice) * Number(NumberOfPackages);

        var Vat = Number($('#Vat').val());
        var VatAmount = (TotalPrice * Vat) / 100;


        var Tax = Number($('#Tax').val());
        var TaxAmount = (TotalPrice * Tax) / 100;


        var ProjectModuleNameIdMultyCheck = $('#ProjectModuleNameId').val();
        let checkMulty = 0;
        $("#tbodyPaymentCalculation tr").each(function () {
            var ProjectModuleNameId = Number($(this).find(".ProjectModuleName").attr("id"));
            if (ProjectModuleNameIdMultyCheck == ProjectModuleNameId) {
                alert("Project Module Name Alredy Add Into List!");
                checkMulty = 1;
            }
            else {
                checkMulty = 0;
            }
        });

        if(checkMulty == 0) {
        var tbodyPaymentCalculation = $("#tbodyPaymentCalculation");
        tbodyPaymentCalculation.append(`
                                          <tr role="row" class="trClass" data-id=${SlNumber}>
                                             <td class="Id">${SlNumber} </td>
                                             <td class="ProjectModuleName" id="${ProjectModuleNameId}">${ProjectModuleName}</td>
                                             <td class="ProjectPackage" id="${ProjectPackageId}">${ProjectPackage}</td>
                                             <td class="UnitPrice" id="UnitPriceId">${UnitPrice}</td>
                                             <td class="NumberOfPackages" id="NumberOfPackagesId">${NumberOfPackages}</td>
                                             <td class="TotalPrice" id="TotalPriceId">${TotalPrice}</td>
                                             <td class="Vat" id="VatId">${VatAmount}</td>
                                             <td class="Tax" id="TaxId">${TaxAmount}</td>
                                             <td class="" id="">
                                                       <button onclick="Remove(${SlNumber})" type="button" class="btn btn-danger pull-right btn-sm">Remove</button>
                                             </td>
                              </tr>
                        `);

        }





        //Total Cal Start
        var TotalPriceAmountPrice = 0;
        var TotalVatPrice = 0;
        var TotalTaxPrice = 0;

        $("#tbodyPaymentCalculation tr").each(function () {
            var TotalPriceAmount = Number($(this).find(".TotalPrice").text());
            TotalPriceAmountPrice = Number(TotalPriceAmountPrice) + TotalPriceAmount;

            var VatPrice = Number($(this).find(".Vat").text());
            TotalVatPrice = TotalVatPrice + Number(VatPrice);

            var TaxPrice = Number($(this).find(".Tax").text());
            TotalTaxPrice = TotalTaxPrice + Number(TaxPrice);

        });
        $("#GrandTotal").val(TotalPriceAmountPrice + TotalVatPrice + TotalTaxPrice);
        var roundFigar = Math.round(TotalPriceAmountPrice + TotalVatPrice + TotalTaxPrice);
        var discountAmount = Number($('#DiscountAmount').val());
        var inWordText = inWords(roundFigar);
        $("#GrandTotalInWord").val(inWordText);

        $('#sumTotalPriceAmountPriceId').text(TotalPriceAmountPrice);
        $('#sumVatPriceId').text(TotalVatPrice);
        $('#sumTaxPriceId').text(TotalTaxPrice);

        //Total Cal end

        $('#DiscountAmount').on('input', function (e) {
            //alert("test");
            var discountAmount = Number($('#DiscountAmount').val());
            var totalDiscountAmount = Number(TotalPriceAmountPrice) - Number(discountAmount);
            $('#NetTotal').val(totalDiscountAmount + Number(TotalVatPrice) + Number(TotalTaxPrice));
            var totalDiscountAmountCal = (100 * Number(discountAmount)) / Number(TotalPriceAmountPrice);
            $('#DiscountPercentage').val(totalDiscountAmountCal);
            $('#DiscountPercentage').prop('readonly', true);

            var inWordText = inWords(totalDiscountAmount + Number(TotalVatPrice) + Number(TotalTaxPrice));
            $("#GrandTotalInWord").val(inWordText);
        });

        $('#DiscountPercentage').on('input', function (e) {
            //alert("test");
            var discountPercentage = Number($('#DiscountPercentage').val());
            var totalDiscountPercentage = (Number(TotalPriceAmountPrice) * Number(discountPercentage)) / 100;
            $('#DiscountAmount').val(totalDiscountPercentage);
            var discountAmount = Number($('#DiscountAmount').val());
            var totalDiscountAmount = Number(TotalPriceAmountPrice) - Number(discountAmount);
            $('#NetTotal').val(totalDiscountAmount + Number(TotalVatPrice) + Number(TotalTaxPrice));
            $('#DiscountAmount').prop('readonly', true);


            var inWordText = inWords(totalDiscountAmount + Number(TotalVatPrice) + Number(TotalTaxPrice));
            $("#GrandTotalInWord").val(inWordText.toFixed(2));
        });

        $('#UnitPrice').val(0);
        $('#NumberOfPackages').val(0);
        $('#TotalPrice').val(0);
        $('#VatAmount').val(0);
        $('#TaxAmount').val(0);
    }
</script>

<script>
    $('#UnitPrice').on('input', function (e) {
        var UnitPrice = Number($('#UnitPrice').val());
        var NumberOfPackages = Number($('#NumberOfPackages').val());
        //$('#TotalPrice').val(0);
        $('#TotalPrice').val(UnitPrice * NumberOfPackages);
    });

    $('#NumberOfPackages').on('input', function (e) {
        var UnitPrice = Number($('#UnitPrice').val());
        var NumberOfPackages = Number($('#NumberOfPackages').val());
        //$('#TotalPrice').val(0);
        $('#TotalPrice').val(UnitPrice * NumberOfPackages);


        var UnitPrice = $('#UnitPrice').val();
        var NumberOfPackages = $('#NumberOfPackages').val();
        var TotalPrice = Number(UnitPrice) * Number(NumberOfPackages);
        var Vat = Number($('#Vat').val());
        var VatAmount = (TotalPrice * Vat) / 100;
        var Tax = Number($('#Tax').val());
        var TaxAmount = (TotalPrice * Tax) / 100;

        $('#VatAmount').val(VatAmount);
        $('#TaxAmount').val(TaxAmount);

    });

</script>

<script>
    var a = ['', 'one ', 'two ', 'three ', 'four ', 'five ', 'six ', 'seven ', 'eight ', 'nine ', 'ten ', 'eleven ', 'twelve ', 'thirteen ', 'fourteen ', 'fifteen ', 'sixteen ', 'seventeen ', 'eighteen ', 'nineteen '];
    var b = ['', '', 'twenty', 'thirty', 'forty', 'fifty', 'sixty', 'seventy', 'eighty', 'ninety'];

    function inWords(num) {
        if ((num = num.toString()).length > 9) return 'overflow';
        n = ('000000000' + num).substr(-9).match(/^(\d{2})(\d{2})(\d{2})(\d{1})(\d{2})$/);
        if (!n) return; var str = '';
        str += (n[1] != 0) ? (a[Number(n[1])] || b[n[1][0]] + ' ' + a[n[1][1]]) + 'crore ' : '';
        str += (n[2] != 0) ? (a[Number(n[2])] || b[n[2][0]] + ' ' + a[n[2][1]]) + 'lakh ' : '';
        str += (n[3] != 0) ? (a[Number(n[3])] || b[n[3][0]] + ' ' + a[n[3][1]]) + 'thousand ' : '';
        str += (n[4] != 0) ? (a[Number(n[4])] || b[n[4][0]] + ' ' + a[n[4][1]]) + 'hundred ' : '';
        str += (n[5] != 0) ? ((str != '') ? 'and ' : '') + (a[Number(n[5])] || b[n[5][0]] + ' ' + a[n[5][1]]) + 'only ' : '';
        return str;
    }

    var grid = $("#grid");
    grid.append(`
                                   <tr role="row" class="" style="font-weight: bold">
                                                 <td class="Id"></td>
                                                 <td id=""></td>
                                                 <td id=""></td>
                                                 <td id=""></td>
                                                 <td id="">Net Bill</td>
                                                 <td class="" id="sumTotalPriceAmountPriceId"></td>
                                                 <td class="" id="sumVatPriceId"></td>
                                                 <td class="" id="sumTaxPriceId"></td>
                                  </tr>
                                      `);




    var grid = $("#grid");
    grid.append(`
                                       <tr role="row" class="" style="font-weight: bold">
                                                     <td colspan="4" class="Id">Total Amount</td>
                                                     <td colspan="5" id=""><input type="number" class="form-control" id="GrandTotal" name="GrandTotal" value="@Model.GrandTotal" placeholder="Enter Grand Total" required readonly></td>
                                                   
                                      </tr>
                                          `);


    var grid = $("#grid");
    grid.append(`
                                               <tr role="row" class="" style="font-weight: bold">
                                                             <td colspan="4" class="Id">Discount Percentage</td>
                                                             <td colspan="5" id=""><input type="number" class="form-control" id="DiscountPercentage" name="DiscountPercentage" value="" placeholder="Enter Discount Percentage" required></td>
                                                             
                                              </tr>
                                                  `);



    var grid = $("#grid");
    grid.append(`
                                           <tr role="row" class="" style="font-weight: bold">
                                                        <td colspan="4" class="Id">Discount Amount</td>
                                                        <td colspan="5" id=""><input type="number" class="form-control" id="DiscountAmount" name="DiscountAmount" value="@Model.DiscountAmount" placeholder="Enter Discount Amount" required></td>
                                                        
                                          </tr>
                                              `);


    var grid = $("#grid");
    grid.append(`
                                               <tr role="row" class="" style="font-weight: bold">
                                                            <td colspan="4" class="Id">Grand Total</td>
                                                            <td colspan="5" id=""><input type="number" class="form-control" id="NetTotal" name="NetTotal" value="@Model.NetTotal" placeholder="Enter Net Total" required readonly></td>
                                                            
                                              </tr>
                                                  `);

    var grid = $("#grid");
    grid.append(`
                                                   <tr role="row" class="" style="font-weight: bold">
                                                                <td colspan="4" class="Id">Grand Total (in words)</td>
                                                                 <td colspan="5" id=""><input type="text" class="form-control" id="GrandTotalInWord" name="GrandTotalInWord" value="@Model.GrandTotalInWord" placeholder="Enter Grand Total In Word" required readonly></td>
                                                                
                                                  </tr>
                                                      `);


</script>

<script>
    var itemDetails = [];
    function Submit(id) {

        $("#tbodyPaymentCalculation tr").each(function () {
            var ProjectModuleName = Number($(this).find(".ProjectModuleName").attr("id"));
            var ProjectPackage = Number($(this).find(".ProjectPackage").attr("id"));
            var UnitPrice = Number($(this).find(".UnitPrice").text());
            var NumberOfPackages = Number($(this).find(".NumberOfPackages").text());
            var TotalPrice = Number($(this).find(".TotalPrice").text());
            var Vat = Number($(this).find(".Vat").text());
            var Tax = Number($(this).find(".Tax").text());

            itemDetails.push({
                //Id: id,
                //Count: count,
                ProjectModuleNameId: ProjectModuleName,
                ProjectPackageId: ProjectPackage,
                UnitPrice: UnitPrice,
                NumberOfPackage: NumberOfPackages,
                TotalPrice: TotalPrice,
                Vat: Vat,
                Tax: Tax
            });
        });


        var formData = new FormData();

        formData.append('ProjectRequestId', $("#ProjectRequestId").val());
        formData.append('TaskOfProjectId', $("#TaskOfProjectId").val());
        formData.append('GrandTotal', $("#GrandTotal").val());
        formData.append('GrandTotalInWord', $("#GrandTotalInWord").val());
        formData.append('DiscountAmount', $("#DiscountAmount").val());
        formData.append('NetTotal', $("#NetTotal").val());

        var PaymentCalculationRows = itemDetails.filter(Boolean);
        formData.append('PaymentCalculationRowsJson', JSON.stringify(PaymentCalculationRows));

        if (SlNumber < 1) { return; }

        $.ajax({
            type: "POST",
            url: "/PaymentCalculationHeader/Create",
            data: formData,
            cache: false,
            contentType: false,
            processData: false,
            dataType: 'json',
            success: function (response) {
                if (id === 1) {
                    window.location.href = "/PaymentCalculationHeader/ViewReport?id=" + response.Data.Id;
                }
                else {
                    window.location.href = "/PaymentCalculationHeader/Index";
                }

                //location.reload();
            }
        });





        alert("save");
    }

    function Remove(id) {
        SlNumber--;
        $(`[data-id=${id}]`).remove();
        //alert(id);
        //Total Cal Start
        var TotalPriceAmountPrice = 0;
        var TotalVatPrice = 0;
        var TotalTaxPrice = 0;

        $("#tbodyPaymentCalculation tr").each(function () {
            var TotalPriceAmount = Number($(this).find(".TotalPrice").text());
            TotalPriceAmountPrice = Number(TotalPriceAmountPrice) + TotalPriceAmount;

            var VatPrice = Number($(this).find(".Vat").text());
            TotalVatPrice = TotalVatPrice + Number(VatPrice);

            var TaxPrice = Number($(this).find(".Tax").text());
            TotalTaxPrice = TotalTaxPrice + Number(TaxPrice);

        });
        $("#GrandTotal").val(TotalPriceAmountPrice + TotalVatPrice + TotalTaxPrice);
        var roundFigar = Math.round(TotalPriceAmountPrice + TotalVatPrice + TotalTaxPrice)
        var inWordText = inWords(roundFigar);
        $("#GrandTotalInWord").val(inWordText);

        $('#sumTotalPriceAmountPriceId').text(TotalPriceAmountPrice);
        $('#sumVatPriceId').text(TotalVatPrice);
        $('#sumTaxPriceId').text(TotalTaxPrice);

        //Total Cal end
    }
</script>


<script>
    $('#UnitPrice').prop('readonly', true);
    $("#ProjectPackageId").on("change", function () {
        var ProjectModuleNameId = Number($("#ProjectModuleNameId").val());
        var ProjectPackageId = Number($("#ProjectPackageId").val());
        $.ajax({
            cache: false,
            type: "POST",
            data: { "ProjectModuleNameId": ProjectModuleNameId, "ProjectPackageId": ProjectPackageId },
            url: "/PaymentCalculationHeader/GetProjectPricingSetupByProjectModuleNameIdAndProjectPackageId",
            success: function (data) {
                $("#UnitPrice").val(data.Data.Price);
                
            },
            error: function (xhr, ajaxOptions, thrownError) {
                //
            }
        });
    });
</script>

<link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/css/select2.min.css" rel="stylesheet" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/js/select2.min.js"></script>
<script>
    $(document).ready(function () {
        $('#ProjectRequestId').select2({
            //data,
            placeholder: 'Select Project',
            //templateResult: optionTemplate,
            //templateSelection: selectionTemplate
        });
        $('#TaskOfProjectId').select2({
            //data,
            placeholder: 'Select Task',
            //templateResult: optionTemplate,
            //templateSelection: selectionTemplate
        });
        $('#ProjectModuleNameId').select2({
            //data,
            placeholder: 'Select Service',
            //templateResult: optionTemplate,
            //templateSelection: selectionTemplate
        });
        $('#ProjectPackageId').select2({
            //data,
            placeholder: 'Select Package',
            //templateResult: optionTemplate,
            //templateSelection: selectionTemplate
        });
    });

   
    
</script>